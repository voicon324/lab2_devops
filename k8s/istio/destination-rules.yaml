# Destination Rules - Define traffic policies for each service
# These rules specify how Istio should handle traffic to each service

# Config Server
apiVersion: networking.istio.io/v1beta1
kind: DestinationRule
metadata:
  name: config-server
  namespace: petclinic
spec:
  host: config-server.petclinic.svc.cluster.local
  trafficPolicy:
    tls:
      mode: ISTIO_MUTUAL
    connectionPool:
      tcp:
        maxConnections: 100
      http:
        h2UpgradePolicy: UPGRADE
        http1MaxPendingRequests: 100
        http2MaxRequests: 1000
---
# Discovery Server
apiVersion: networking.istio.io/v1beta1
kind: DestinationRule
metadata:
  name: discovery-server
  namespace: petclinic
spec:
  host: discovery-server.petclinic.svc.cluster.local
  trafficPolicy:
    tls:
      mode: ISTIO_MUTUAL
    connectionPool:
      tcp:
        maxConnections: 100
      http:
        h2UpgradePolicy: UPGRADE
        http1MaxPendingRequests: 100
        http2MaxRequests: 1000
---
# API Gateway
apiVersion: networking.istio.io/v1beta1
kind: DestinationRule
metadata:
  name: api-gateway
  namespace: petclinic
spec:
  host: api-gateway.petclinic.svc.cluster.local
  trafficPolicy:
    tls:
      mode: ISTIO_MUTUAL
    connectionPool:
      tcp:
        maxConnections: 100
      http:
        h2UpgradePolicy: UPGRADE
        http1MaxPendingRequests: 100
        http2MaxRequests: 1000
---
# Customers Service
apiVersion: networking.istio.io/v1beta1
kind: DestinationRule
metadata:
  name: customers-service
  namespace: petclinic
spec:
  host: customers-service.petclinic.svc.cluster.local
  trafficPolicy:
    tls:
      mode: ISTIO_MUTUAL
    connectionPool:
      tcp:
        maxConnections: 100
      http:
        h2UpgradePolicy: UPGRADE
        http1MaxPendingRequests: 100
        http2MaxRequests: 1000
---
# Visits Service
apiVersion: networking.istio.io/v1beta1
kind: DestinationRule
metadata:
  name: visits-service
  namespace: petclinic
spec:
  host: visits-service.petclinic.svc.cluster.local
  trafficPolicy:
    tls:
      mode: ISTIO_MUTUAL
    connectionPool:
      tcp:
        maxConnections: 100
      http:
        h2UpgradePolicy: UPGRADE
        http1MaxPendingRequests: 100
        http2MaxRequests: 1000
---
# Vets Service
apiVersion: networking.istio.io/v1beta1
kind: DestinationRule
metadata:
  name: vets-service
  namespace: petclinic
spec:
  host: vets-service.petclinic.svc.cluster.local
  trafficPolicy:
    tls:
      mode: ISTIO_MUTUAL
    connectionPool:
      tcp:
        maxConnections: 100
      http:
        h2UpgradePolicy: UPGRADE
        http1MaxPendingRequests: 100
        http2MaxRequests: 1000
---
# GenAI Service
apiVersion: networking.istio.io/v1beta1
kind: DestinationRule
metadata:
  name: genai-service
  namespace: petclinic
spec:
  host: genai-service.petclinic.svc.cluster.local
  trafficPolicy:
    tls:
      mode: ISTIO_MUTUAL
    connectionPool:
      tcp:
        maxConnections: 100
      http:
        h2UpgradePolicy: UPGRADE
        http1MaxPendingRequests: 100
        http2MaxRequests: 1000
